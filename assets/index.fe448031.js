var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var G=(o,t,n)=>t in o?Q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,P=(o,t)=>{for(var n in t||(t={}))Y.call(t,n)&&G(o,n,t[n]);if(z)for(var n of z(t))ee.call(t,n)&&G(o,n,t[n]);return o},B=(o,t)=>W(o,X(t));import{r as te,t as oe,m as E,Z as T,H as U,a as w,o as ae,b as m,c as r,d as g,w as s,e as q,f as a,g as ne,h as x,i as le,j as f,k as $,v as re,l as se,n as ie,F as ce,p as de,q as ue,s as C,K as F,u as _e,x as pe,T as K,y as me,z as fe,A as ve,Q as he}from"./vendor.dace68ca.js";const ye=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))e(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&e(d)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}};ye();const be="/alpha.json",qe="/defs.zinc",I=te({loading:!0});let J;async function we(){var e;const o=await(await fetch(qe)).text(),t=(e=new T(o).readValue())!=null?e:new U,n=new w(t);w.defaultNamespace=n}async function ge(){I.loading=!0;try{await we();const o=await(await fetch(be)).json();J=E(o)}catch(o){console.log(`Failed to init the database: ${o}`)}finally{I.loading=!1}}function A(){return B(P({},oe(I)),{database:()=>J,setDatabase:o=>{J=o},fetchJsonDatabase:ge})}var D=(o,t)=>{const n=o.__vccOpts||o;for(const[e,l]of t)n[e]=l;return n};const xe={name:"LayoutDefault",setup(){const{database:o,fetchJsonDatabase:t,loading:n}=A();return ae(()=>{t()}),{database:o,loading:n,leftDrawerOpen:m(!1)}}},Ee=x(" Haystack Test Console "),Ve=x("Activities"),De=x("Evaluate"),Se=x("Load tag database"),ke=x("Load custom defs");function He(o,t,n,e,l,i){const d=r("q-btn"),p=r("q-toolbar-title"),_=r("q-toolbar"),y=r("q-header"),u=r("q-item-label"),c=r("q-icon"),v=r("q-item-section"),h=r("q-item"),S=r("q-list"),k=r("q-drawer"),H=r("router-view"),O=r("q-page-container"),N=r("q-linear-progress"),j=r("q-footer"),L=r("q-layout");return q(),g(L,{view:"hHh lpR fFf"},{default:s(()=>[a(y,{elevated:""},{default:s(()=>[a(_,null,{default:s(()=>[a(d,{flat:"",dense:"",round:"","aria-label":"Menu",icon:"menu",onClick:t[0]||(t[0]=V=>e.leftDrawerOpen=!e.leftDrawerOpen)}),a(p,null,{default:s(()=>[Ee]),_:1})]),_:1})]),_:1}),a(k,{modelValue:e.leftDrawerOpen,"onUpdate:modelValue":t[1]||(t[1]=V=>e.leftDrawerOpen=V),"show-if-above":"",bordered:"",class:"bg-grey-2"},{default:s(()=>[a(S,null,{default:s(()=>[a(u,{header:""},{default:s(()=>[Ve]),_:1}),a(h,{clickable:"",to:"/eval"},{default:s(()=>[a(v,{avatar:""},{default:s(()=>[a(c,{name:"javascript"})]),_:1}),a(v,null,{default:s(()=>[a(u,null,{default:s(()=>[De]),_:1})]),_:1})]),_:1}),a(h,{clickable:"",to:"/load-data"},{default:s(()=>[a(v,{avatar:""},{default:s(()=>[a(c,{name:"tag"})]),_:1}),a(v,null,{default:s(()=>[a(u,null,{default:s(()=>[Se]),_:1})]),_:1})]),_:1}),a(h,{clickable:"",to:"/load-defs"},{default:s(()=>[a(v,{avatar:""},{default:s(()=>[a(c,{name:"code"})]),_:1}),a(v,null,{default:s(()=>[a(u,null,{default:s(()=>[ke]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,null,{default:s(()=>[a(H)]),_:1}),a(j,null,{default:s(()=>[e.loading?(q(),g(N,{key:0,size:"lg",indeterminate:""})):ne("",!0)]),_:1})]),_:1})}var Oe=D(xe,[["render",He]]);function R(o,t,n){var e,l;t.value=(e=o==null?void 0:o.getColumnNames().map(i=>({label:i.toUpperCase(),name:i,field:i,align:"center",format:d=>{var p;return d?(p=E(d))==null?void 0:p.toString():""}})))!=null?e:[],n.value=(l=o==null?void 0:o.getRows().map(i=>i.toJSON()))!=null?l:[]}const Ne=[{id:0,type:"HF",expr:'^geoPlace and dis=="Alpha"'},{id:1,type:"JS",expr:`this.filter(r => r.kind?.value === "Bool" && r.has('cmd'))`},{id:2,type:"HF",expr:"inputs-hot-water?"}],je={name:"Code Evaluation",setup(){const o=m(""),t=m(""),n=m([]),e=m([]),l=m(Ne),{database:i}=A(),d=_=>{(!l.value.length||l.value[0].expr!==_.expr)&&l.value.unshift(_)},p=()=>{var _,y;t.value&&(t.value="");try{const u=new de(o.value),c=(y=(_=i())==null?void 0:_.filter(u.node,{namespace:w.defaultNamespace}))!=null?y:U.make();R(c,n,e),d({id:l.value.length,type:"HF",expr:o.value})}catch(u){try{const v=Function('"use strict";const namespace = arguments[0];return ('+o.value+")").apply(i(),[w.defaultNamespace]),h=ue(v)?v:E(v);C(h,F.Grid)?R(h,n,e):R(new U({rows:[new _e({res:h!=null?h:""})]}),n,e),d({id:l.value.length,type:"JS",expr:o.value})}catch(c){console.log(u),console.log(c),t.value=`Evaluation Error: '${c}', or '${u}'`}}};return{expr:o,evalErr:t,columns:n,rows:e,exprHis:l,showExprHis:m(!1),initialPagination:{sortBy:"desc",descending:!1,rowsPerPage:10},clearErr(){t.value=""},loadFromHis(_){o.value=_,p()},onSubmit(){o.value&&p()}}}},Le={class:"row",style:{width:"100%"}},Te={class:"col-12.col-md-auto",style:{"padding-right":"1em",width:"85%"}},Ue={class:"col"},Ce={style:{width:"100%","padding-top":"1em"}},Fe={class:"row",style:{width:"100%","padding-top":"1em"}};function Ie(o,t,n,e,l,i){const d=r("q-input"),p=r("q-btn"),_=r("q-icon"),y=r("q-avatar"),u=r("q-item-section"),c=r("q-item-label"),v=r("q-item"),h=r("q-list"),S=r("q-scroll-area"),k=r("q-card-section"),H=r("q-card"),O=r("q-expansion-item"),N=r("q-table"),j=r("q-form"),L=r("q-page"),V=le("ripple");return q(),g(L,{class:"flex flex-top",padding:"",style:{width:"95%"}},{default:s(()=>[a(j,{style:{width:"100%"},onSubmit:e.onSubmit},{default:s(()=>[f("div",Le,[f("div",Te,[a(d,{modelValue:e.expr,"onUpdate:modelValue":[t[0]||(t[0]=b=>e.expr=b),e.clearErr],name:"name",color:"primary",label:"Expression",square:"",outlined:"",clearable:"",autogrow:"","error-message":e.evalErr,error:!!e.evalErr,style:{"min-width":"100%"}},null,8,["modelValue","onUpdate:modelValue","error-message","error"])]),f("div",Ue,[a(p,{label:"Run",type:"submit",color:"primary",icon:"bolt"})])]),a(O,{modelValue:e.showExprHis,"onUpdate:modelValue":t[1]||(t[1]=b=>e.showExprHis=b),"expand-separator":"",icon:"history",label:"History"},{default:s(()=>[a(H,null,{default:s(()=>[a(k,null,{default:s(()=>[$(f("div",Ce,[a(S,{style:{width:"100%",height:"115px"}},{default:s(()=>[a(h,{style:{width:"100%"},bordered:"",separator:""},{default:s(()=>[(q(!0),se(ce,null,ie(e.exprHis,b=>$((q(),g(v,{key:b.id,clickable:"",style:{width:"100%"},onClick:ot=>e.loadFromHis(b.expr)},{default:s(()=>[a(u,{avatar:""},{default:s(()=>[a(y,{color:"primary","text-color":"white"},{default:s(()=>[a(_,{name:b.type=="JS"?"javascript":"filter_alt",color:"gray"},null,8,["name"])]),_:2},1024)]),_:2},1024),a(u,null,{default:s(()=>[a(c,null,{default:s(()=>[x(pe(b.expr),1)]),_:2},1024)]),_:2},1024),a(u,{side:""},{default:s(()=>[a(_,{name:"bolt",color:"gray"})]),_:1})]),_:2},1032,["onClick"])),[[V]])),128))]),_:1})]),_:1})],512),[[re,e.showExprHis]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),f("div",Fe,[a(N,{columns:e.columns,"row-key":"id",rows:e.rows,style:{width:"100%",height:"75%"},pagination:e.initialPagination,"no-data-label":"Empty grid"},null,8,["columns","rows","pagination"])])]),_:1},8,["onSubmit"])]),_:1})}var M=D(je,[["render",Ie]]);const Je={name:"Load Data",setup(){const o=m(null),t=m("json"),n=m(""),{setDatabase:e}=A();return{importData:o,importErr:n,dataType:t,dataOptions:[{label:"JSON",value:"json"},{label:"Zinc",value:"zinc"},{label:"Trio",value:"trio"}],clearErr(){n.value=""},onSubmit(){if(o.value){n.value&&(n.value="");try{let l;switch(t.value){case"json":{const i=JSON.parse(o.value);l=E(i);break}case"zinc":{l=new T(o.value).readValue();break}case"trio":{l=new K(o.value).readGrid();break}default:throw Error("Invalid data type.")}C(l,F.Grid)?e(l):n.value="Can't load non-grid data"}catch(l){console.log(l),n.value=`Import Error: '${l}'`}}}}}},Ae={class:"row",style:{width:"100%"}},Re={class:"col-12.col-md-auto",style:{"padding-right":"1em",width:"85%"}},ze={class:"col"},Ge={class:"row",style:{width:"100%"}};function Pe(o,t,n,e,l,i){const d=r("q-input"),p=r("q-btn"),_=r("q-option-group"),y=r("q-form"),u=r("q-page");return q(),g(u,{class:"flex flex-top",padding:"",style:{width:"95%"}},{default:s(()=>[a(y,{style:{width:"100%"},onSubmit:e.onSubmit},{default:s(()=>[f("div",Ae,[f("div",Re,[a(d,{modelValue:e.importData,"onUpdate:modelValue":[t[0]||(t[0]=c=>e.importData=c),e.clearErr],name:"name",color:"primary",label:"Database Grid Data",square:"",outlined:"",clearable:"",autogrow:"","error-message":e.importErr,error:!!e.importErr,style:{"min-width":"100%"}},null,8,["modelValue","error-message","error","onUpdate:modelValue"])]),f("div",ze,[a(p,{label:"Import",type:"submit",color:"primary",icon:"upload"})])]),f("div",Ge,[a(_,{modelValue:e.dataType,"onUpdate:modelValue":t[1]||(t[1]=c=>e.dataType=c),options:e.dataOptions,color:"primary",inline:""},null,8,["modelValue","options"])])]),_:1},8,["onSubmit"])]),_:1})}var Be=D(Je,[["render",Pe]]);const $e={name:"Load Defs",setup(){const o=m(null),t=m("json"),n=m("");return{importData:o,importErr:n,dataType:t,dataOptions:[{label:"JSON",value:"json"},{label:"Zinc",value:"zinc"},{label:"Trio",value:"trio"}],clearErr(){n.value=""},onSubmit(){if(o.value){n.value&&(n.value="");try{let e;switch(t.value){case"json":{const l=JSON.parse(o.value);e=E(l);break}case"zinc":{e=new T(o.value).readValue();break}case"trio":{e=new K(o.value).readGrid();break}default:throw Error("Invalid data type.")}if(C(e,F.Grid)){const l=new w(e);w.defaultNamespace=l}else n.value="Can't load non-grid data"}catch(e){console.log(e),n.value=`Import Error: '${e}'`}}}}}},Ke={class:"row",style:{width:"100%"}},Me={class:"col-12.col-md-auto",style:{"padding-right":"1em",width:"85%"}},Ze={class:"col"},Qe={class:"row",style:{width:"100%"}};function We(o,t,n,e,l,i){const d=r("q-input"),p=r("q-btn"),_=r("q-option-group"),y=r("q-form"),u=r("q-page");return q(),g(u,{class:"flex flex-top",padding:"",style:{width:"95%"}},{default:s(()=>[a(y,{style:{width:"100%"},onSubmit:e.onSubmit},{default:s(()=>[f("div",Ke,[f("div",Me,[a(d,{modelValue:e.importData,"onUpdate:modelValue":[t[0]||(t[0]=c=>e.importData=c),e.clearErr],name:"name",color:"primary",label:"Defs Grid Data",square:"",outlined:"",clearable:"",autogrow:"","error-message":e.importErr,error:!!e.importErr,style:{"min-width":"100%"}},null,8,["modelValue","error-message","error","onUpdate:modelValue"])]),f("div",Ze,[a(p,{label:"Import",type:"submit",color:"primary",icon:"upload"})])]),f("div",Qe,[a(_,{modelValue:e.dataType,"onUpdate:modelValue":t[1]||(t[1]=c=>e.dataType=c),options:e.dataOptions,color:"primary",inline:""},null,8,["modelValue","options"])])]),_:1},8,["onSubmit"])]),_:1})}var Xe=D($e,[["render",We]]);const Ye=[{path:"/",component:M},{path:"/eval",component:M},{path:"/load-data",component:Be},{path:"/load-defs",component:Xe}],et=me({history:fe(),routes:Ye});var tt={config:{},plugins:{}};const Z=ve(Oe);Z.use(et);Z.use(he,tt).mount("#app");
